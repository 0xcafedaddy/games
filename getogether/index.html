<!DOCTYPE html> 
<head> 
	<meta charset="UTF-8" />
	<title>getogether</title>
    <script src="../phaser.min.js"></script>
    <style>
        body{
            margin: 0;
            padding: 0;
        }
        canvas {
            margin: 0 auto;
        }
    </style>
</head>
<body>
<script>

var game = new Phaser.Game(270, 480, Phaser.AUTO, '');

game.States = {};

game.States.boot = function() {
    this.preload = function() {
        if(!game.device.desktop){
            this.scale.scaleMode = Phaser.ScaleManager.EXACT_FIT;
            this.scale.forcePortrait = true;
            this.scale.refresh();
        }
        game.load.image('loading', 'assets/preloader.gif');
    };
    this.create = function() {
        game.state.start('preload');
    };
};

game.States.preload = function() {
    this.preload = function() {
        var preloadSprite = game.add.sprite(25, game.height/2, 'loading');
        game.load.setPreloadSprite(preloadSprite);
        game.load.image('background', 'assets/background.png');
        game.load.image('prescene1', 'assets/prescene1.png');
        game.load.image('scene1', 'assets/scene1.png');
        game.load.image('ground', 'assets/ground.png');
        game.load.image('heart', 'assets/heart.png');
        game.load.spritesheet('man', 'assets/man.png', 20, 60);
        game.load.spritesheet('woman', 'assets/woman.png', 20, 60);
        game.load.image('leftpad', 'assets/leftpad.png');
        game.load.image('rightpad', 'assets/rightpad.png');
        game.load.image('uppad', 'assets/uppad.png');
    };
    this.create = function() {
        //game.state.start('start');
        game.state.start('scene1');
    };
};

game.States.start = function() {
    this.create = function() {
        game.add.sprite(0, 0, 'background');
        this.man = game.add.sprite(20, 292, 'man');
        this.woman = game.add.sprite(230, 292, 'woman');
        this.man.animations.add('left', [0, 1, 2, 3], 10, true);
        this.man.animations.add('right', [5, 6, 7, 8], 10, true);
        this.woman.animations.add('left', [0, 1, 2, 3], 10, true);
        this.woman.animations.add('right', [5, 6, 7, 8], 10, true);
        this.man.frame = 4;
        this.woman.frame = 4;
        game.physics.arcade.enable(this.man);
        game.physics.arcade.enable(this.woman);
        game.time.events.add(1000, function() {
            this.man.animations.play('right');
            this.woman.animations.play('left');
            this.man.body.velocity.x = 60;
            this.woman.body.velocity.x = -60;
        }, this);
    };
    this.update = function() {
        game.physics.arcade.collide(this.man, this.woman, this.met, null, this);
    };
    this.met = function() {
        this.man.animations.stop();
        this.woman.animations.stop();
        this.man.frame = 4;
        this.woman.frame = 4;
        game.add.sprite(this.man.position.x, this.man.position.y + 10, 'heart');
        game.time.events.add(1000, function() {
            game.state.start('prescene1');
        }, this);
    };
};

game.States.prescene1 = function() {
    this.create = function() {
        game.add.sprite(0, 0, 'prescene1');
        game.time.events.add(2000, function() {
            game.state.start('scene1');
        }, this);
    };
};

game.States.scene1 = function() {
    var left = false;
    var right = false;
    var up = false;
    this.create = function() {
        game.add.sprite(0, 0, 'scene1');
        this.ground = game.add.sprite(7, 352, 'ground');
        this.man = game.add.sprite(20, 272, 'man');
        this.woman = game.add.sprite(230, 272, 'woman');
        this.man.animations.add('left', [0, 1, 2, 3], 10, true);
        this.man.animations.add('right', [5, 6, 7, 8], 10, true);
        this.woman.animations.add('left', [0, 1, 2, 3], 10, true);
        this.woman.animations.add('right', [5, 6, 7, 8], 10, true);
        
        leftpad = game.add.button(10, 400, 'leftpad');
        uppad = game.add.button(100, 400, 'uppad');
        rightpad = game.add.button(190, 400, 'rightpad');
        
        leftpad.events.onInputOver.add(function(){left = true;});
        leftpad.events.onInputOut.add(function(){left = false;});
        leftpad.events.onInputDown.add(function(){left = true;});
        leftpad.events.onInputUp.add(function(){left = false;});
        rightpad.events.onInputOver.add(function(){right = true;});
        rightpad.events.onInputOut.add(function(){right = false;});
        rightpad.events.onInputDown.add(function(){right = true;});
        rightpad.events.onInputUp.add(function(){right = false;});
        uppad.events.onInputOver.add(function(){up = true;});
        uppad.events.onInputOut.add(function(){up = false;});
        uppad.events.onInputDown.add(function(){up = true;});
        uppad.events.onInputUp.add(function(){up = false;});
        
        game.physics.arcade.enable(this.man);
        game.physics.arcade.enable(this.woman);
        game.physics.arcade.enable(this.ground);
        
        this.man.body.gravity.y = 200;
        this.woman.body.gravity.y = 200;
        this.ground.body.immovable = true;
    };
    this.update = function() {
        game.physics.arcade.collide(this.man, this.ground);
        game.physics.arcade.collide(this.woman, this.ground);
        if(left) {
            this.man.body.velocity.x = -60;
            this.man.animations.play('left');
        } else if(right) {
            this.man.body.velocity.x = 60;
            this.man.animations.play('right');
        } else if(up && this.man.body.touching.down) {
            this.man.body.velocity.x = 0;
            this.man.body.velocity.y = -150;
            this.man.animations.stop();
            this.man.frame = 4;
        } else {
            this.man.body.velocity.x = 0;
            this.man.animations.stop();
            this.man.frame = 4;
        }
    };
};

game.state.add('boot', game.States.boot);
game.state.add('preload', game.States.preload);
game.state.add('start', game.States.start);
game.state.add('prescene1', game.States.prescene1);
game.state.add('scene1', game.States.scene1);

game.state.start('boot');

</script>

</body>